# =============================================================================
# 4-Digit Number Guessing Game - Docker Compose
# =============================================================================
# Usage:
#   Development:  docker-compose up
#   Production:   docker-compose -f docker-compose.yml -f docker-compose.prod.yml up -d
#   Build:        docker-compose build
#   Stop:         docker-compose down
#   Logs:         docker-compose logs -f

version: '3.8'

services:
  # ---------------------------------------------------------------------------
  # Game Application
  # ---------------------------------------------------------------------------
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    container_name: number-guess-game
    restart: unless-stopped
    ports:
      - "${PORT:-5000}:5000"
    environment:
      - DEBUG=${DEBUG:-false}
      - SECRET_KEY=${SECRET_KEY:-change-me-in-production}
      - ADMIN_KEY=${ADMIN_KEY:-change-me-in-production}
      - CORS_ORIGINS=${CORS_ORIGINS:-}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - TURN_TIMEOUT_SECONDS=${TURN_TIMEOUT_SECONDS:-60}
      - DB_PATH=/app/data/game.db
    volumes:
      # Persist database
      - game-data:/app/data
    healthcheck:
      test: ["CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:5000/health')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - game-network

# -----------------------------------------------------------------------------
# Volumes
# -----------------------------------------------------------------------------
volumes:
  game-data:
    driver: local

# -----------------------------------------------------------------------------
# Networks
# -----------------------------------------------------------------------------
networks:
  game-network:
    driver: bridge
